<ion-content class="admin-layout">
  <div class="layout-container">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <img src="assets/usjrlogo.png" class="sidebar-logo-img" />
        <h1 class="logo-text">
          <span class="green">JOSENIAN</span><span class="yellow">LINK</span> ðŸ”—
        </h1>
      </div>

      <div class="nav-links">
        <div class="nav-item" [class.active]="activeTab === 'dashboard'" (click)="switchTab('dashboard')">
          <ion-icon name="grid-outline"></ion-icon>
          <span>Dashboard</span>
        </div>
        <div class="nav-item" [class.active]="activeTab === 'alumni'" (click)="switchTab('alumni')">
          <ion-icon name="people-outline"></ion-icon>
          <span>Alumni</span>
        </div>
        <div class="nav-item" [class.active]="activeTab === 'registry-approval'" (click)="switchTab('registry-approval')">
          <ion-icon name="checkmark-circle-outline"></ion-icon>
          <span>Registry Approval</span>
        </div>
        <div class="nav-item" [class.active]="activeTab === 'reports'" (click)="switchTab('reports')">
          <ion-icon name="document-text-outline"></ion-icon>
          <span>Reports</span>
        </div>
        <div class="nav-item" [class.active]="activeTab === 'events'" (click)="switchTab('events')">
          <ion-icon name="calendar-outline"></ion-icon>
          <span>Events</span>
        </div>
        <div class="nav-item" [class.active]="activeTab === 'freedom-wall'" (click)="switchTab('freedom-wall')">
          <ion-icon name="chatbubbles-outline"></ion-icon>
          <span>Freedom Wall</span>
        </div>
      </div>
    </div>

    <!-- Main Content Area -->
    <div class="main-content">
      <div class="main-panel">
        <!-- Dashboard Tab -->
        <div *ngIf="activeTab === 'dashboard'">
          <div class="panel-header">
            <div>
              <h2>Dashboard</h2>
              <p class="breadcrumb">Dashboard / Alumni ID Requests</p>
            </div>
            <div class="header-actions">
              <ion-button fill="outline" size="small" color="primary" (click)="testNotification()">
                <ion-icon name="flash" slot="start"></ion-icon>
                Test Notification for Ravi
              </ion-button>
              <ion-button fill="clear" class="notification-btn">
                <ion-icon name="notifications-outline"></ion-icon>
                <ion-badge color="danger" *ngIf="notifCount > 0">{{ notifCount }}</ion-badge>
              </ion-button>
            </div>
          </div>

          <!-- ====== Stats Row ====== -->
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon"><ion-icon name="people"></ion-icon></div>
              <div class="stat-meta">
                <div class="stat-label">Registered Alumni</div>
                <div class="stat-value">{{ totals?.alumni || 0 }}</div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon"><ion-icon name="calendar"></ion-icon></div>
              <div class="stat-meta">
                <div class="stat-label">Total Events</div>
                <div class="stat-value">{{ totals?.events || 0 }}</div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon"><ion-icon name="id-card"></ion-icon></div>
              <div class="stat-meta">
                <div class="stat-label">Alumni ID Requests</div>
                <div class="stat-value">{{ totals?.idRequests || 0 }}</div>
              </div>
            </div>
            <div class="stat-card warning">
              <div class="stat-icon"><ion-icon name="hourglass"></ion-icon></div>
              <div class="stat-meta">
                <div class="stat-label">Pending Approval</div>
                <div class="stat-value">{{ totals?.pending || 0 }}</div>
              </div>
            </div>
          </div>

          <!-- ====== Lists Row (3 cards) ====== -->
          <div class="lists-grid">
            <!-- Registered Alumni -->
            <div class="list-card">
              <div class="list-card-header">
                <h3><ion-icon name="people-outline"></ion-icon> Registered Alumni</h3>
                <ion-button size="small" fill="clear" (click)="switchTab('alumni')">View all</ion-button>
              </div>
              <ion-list lines="full">
                <ion-item *ngFor="let a of alumniList | slice:0:5">
                  <ion-avatar slot="start">
                    <img [src]="a.photo || 'assets/default-avatar.png'">
                  </ion-avatar>
                  <ion-label>
                    <div class="row1">
                      <span class="name">{{ a.name }}</span>
                      <ion-badge *ngIf="a.program">{{ a.program }}</ion-badge>
                    </div>
                    <div class="row2">{{ a.email }}</div>
                  </ion-label>
                </ion-item>
                <div *ngIf="(alumniList?.length || 0) === 0" class="empty-state">
                  <ion-icon name="person-circle-outline"></ion-icon>
                  <p>No registered alumni found.</p>
                </div>
              </ion-list>
            </div>

            <!-- Events -->
            <div class="list-card">
              <div class="list-card-header">
                <h3><ion-icon name="calendar-outline"></ion-icon> Events</h3>
                <ion-button size="small" fill="clear" (click)="switchTab('events')">View all</ion-button>
              </div>
              <ion-list lines="full">
                <ion-item *ngFor="let e of eventsList | slice:0:5">
                  <ion-label>
                    <div class="row1">
                      <span class="name">{{ e.title }}</span>
                      <ion-badge>{{ e.department || 'All' }}</ion-badge>
                    </div>
                    <div class="row2">
                      {{ e.start?.toDate?.() ? (e.start.toDate() | date:'mediumDate') : (e.start | date:'mediumDate') }}
                      â€¢ {{ e.location || 'TBA' }}
                    </div>
                  </ion-label>
                </ion-item>
                <div *ngIf="(eventsList?.length || 0) === 0" class="empty-state">
                  <ion-icon name="calendar-clear-outline"></ion-icon>
                  <p>No events posted.</p>
                </div>
              </ion-list>
            </div>

            <!-- Alumni ID Requests -->
            <div class="list-card">
              <div class="list-card-header">
                <h3><ion-icon name="id-card-outline"></ion-icon> Alumni ID Requests</h3>
                <ion-button size="small" fill="clear">View all</ion-button>
              </div>
              <ion-list lines="full">
                <ion-item *ngFor="let r of idRequestsList | slice:0:5">
                  <ion-label>
                    <div class="row1">
                      <span class="name">{{ r.userName }}</span>
                      <ion-badge [color]="r.status === 'approved' ? 'success' : (r.status === 'rejected' ? 'danger' : 'warning')">
                        {{ r.status | titlecase }}
                      </ion-badge>
                    </div>
                    <div class="row2">
                      {{ r.userEmail }} â€¢
                      {{ r.timestamp?.toDate?.() ? (r.timestamp.toDate() | date:'short') : (r.timestamp | date:'short') }}
                    </div>
                  </ion-label>
                </ion-item>
                <div *ngIf="(idRequestsList?.length || 0) === 0" class="empty-state">
                  <ion-icon name="id-card-outline"></ion-icon>
                  <p>No Alumni ID requests.</p>
                </div>
              </ion-list>
            </div>
          </div>

          <!-- ====== Pending Requests (Approval table) ====== -->
          <div class="panel-subheader">
            <h3>
              <ion-icon name="hourglass-outline"></ion-icon>
              Pending Alumni ID Requests
            </h3>
            <p class="muted">Review and approve or reject requests below. Actions will send notifications to users.</p>
          </div>

          <div class="table-container">
            <div *ngIf="loadingAlumniIdRequests" class="loading-state">
              <ion-spinner name="crescent"></ion-spinner>
              <p>Loading Alumni ID requests...</p>
            </div>

            <div class="requests-grid" *ngIf="!loadingAlumniIdRequests">
              <div class="request-card" *ngFor="let request of alumniIdRequests">
                <div class="request-header">
                  <div class="user-info">
                    <div class="user-avatar">
                      <ion-icon name="person-circle" *ngIf="!request.userPhoto"></ion-icon>
                      <img [src]="request.userPhoto" *ngIf="request.userPhoto" alt="User Photo">
                    </div>
                    <div class="user-details">
                      <h4 class="user-name">{{ request.name || request.userName }}</h4>
                      <p class="user-email">{{ request.email || request.userEmail }}</p>
                      <span class="status-badge" [ngClass]="{
                        'approved': request.status === 'approved',
                        'pending': request.status === 'pending',
                        'rejected': request.status === 'rejected'
                      }">{{ request.status | titlecase }}</span>
                    </div>
                  </div>
                  <div class="request-date">
                    <span class="date-label">Requested</span>
                    <span class="date-value">{{ request.timestamp?.toDate?.() ? (request.timestamp.toDate() | date:'MMM d, y') : (request.timestamp | date:'MMM d, y') }}</span>
                  </div>
                </div>

                <div class="request-body">
                  <div class="info-grid">
                    <div class="info-item">
                      <ion-icon name="school-outline"></ion-icon>
                      <div>
                        <span class="info-label">Course/Program</span>
                        <span class="info-value">{{ request.course || 'Not specified' }}</span>
                      </div>
                    </div>
                    <div class="info-item">
                      <ion-icon name="calendar-outline"></ion-icon>
                      <div>
                        <span class="info-label">Year Graduated</span>
                        <span class="info-value">{{ request.yearGraduated || 'Not specified' }}</span>
                      </div>
                    </div>
                    <div class="info-item" *ngIf="request.studentId">
                      <ion-icon name="id-card-outline"></ion-icon>
                      <div>
                        <span class="info-label">Student ID</span>
                        <span class="info-value">{{ request.studentId }}</span>
                      </div>
                    </div>
                    <div class="info-item" *ngIf="request.contactNumber">
                      <ion-icon name="call-outline"></ion-icon>
                      <div>
                        <span class="info-label">Contact Number</span>
                        <span class="info-value">{{ request.contactNumber }}</span>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="request-actions" *ngIf="request.status === 'pending'">
                  <ion-button
                    color="danger"
                    fill="outline"
                    size="small"
                    (click)="rejectRequest(request)"
                    [disabled]="request.__busy">
                    <ion-icon name="close" slot="start"></ion-icon>
                    Reject
                  </ion-button>
                  <ion-button
                    color="success"
                    fill="solid"
                    size="small"
                    (click)="approveRequest(request)"
                    [disabled]="request.__busy">
                    <ion-icon name="checkmark" slot="start"></ion-icon>
                    Approve
                  </ion-button>
                </div>

                <div class="request-approved" *ngIf="request.status === 'approved'">
                  <ion-icon name="checkmark-circle" color="success"></ion-icon>
                  <span>Approved</span>
                  <span class="alumni-id" *ngIf="request.alumniId">ID: {{ request.alumniId }}</span>
                </div>

                <div class="request-rejected" *ngIf="request.status === 'rejected'">
                  <ion-icon name="close-circle" color="danger"></ion-icon>
                  <span>Rejected</span>
                </div>
              </div>

              <div class="empty-requests" *ngIf="alumniIdRequests.length === 0">
                <ion-icon name="id-card-outline"></ion-icon>
                <h3>No Alumni ID Requests</h3>
                <p>All requests have been processed or no new requests have been submitted.</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Alumni Management Tab -->
        <div *ngIf="activeTab === 'alumni'">
          <div class="panel-header">
            <div>
              <h2>Alumni</h2>
              <p class="breadcrumb">Dashboard / Alumni Management</p>
            </div>
            <div class="header-actions">
              <p class="role-label">Alumni Officer</p>
              <ion-button fill="clear" class="notification-btn">
                <ion-icon name="notifications-outline"></ion-icon>
                <ion-badge color="danger">3</ion-badge>
              </ion-button>
            </div>
          </div>

        <div class="search-filter-bar">
          <ion-searchbar 
            placeholder="Search by name, ID or program" 
            class="search-bar"
            animated
            debounce="300"
            (ionInput)="searchUsers($event)">
          </ion-searchbar>
          <ion-button class="filter-btn">
            <ion-icon name="filter-outline" slot="start"></ion-icon>
            Filters
          </ion-button>
          <ion-button color="primary" class="add-btn" routerLink="/register">
            <ion-icon name="add-outline" slot="start"></ion-icon>
            Add Alumni
          </ion-button>
        </div>

        <div class="alumni-management-container">
          <!-- Loading State -->
          <div *ngIf="loading" class="loading-state">
            <ion-spinner name="crescent"></ion-spinner>
            <p>Loading alumni...</p>
          </div>

          <!-- Alumni Table -->
          <div class="alumni-table-container" *ngIf="!loading">
            <table class="alumni-table">
              <thead>
                <tr>
                  <th class="user-col-enhanced">Alumni Information</th>
                  <th class="year-col">Year</th>
                  <th class="contact-col">Contact</th>
                  <th class="status-col">Status</th>
                  <th class="role-col">Role</th>
                  <th class="actions-col">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let alumni of filteredAlumniList; trackBy: trackByUid" class="alumni-row">
                  <!-- User Column with Enhanced Layout -->
                  <td class="user-cell">
                    <div class="user-info-enhanced">
                      <div class="user-avatar-circle">
                        <img [src]="alumni.photo" [alt]="alumni.name" />
                        <div class="status-dot" [class.verified]="alumni.verified" [class.pending]="!alumni.verified"></div>
                      </div>
                      <div class="user-details-enhanced">
                        <div class="name-section">
                          <span class="first-name">{{ getFirstName(alumni.name) }}</span>
                          <span class="last-name">{{ getLastName(alumni.name) }}</span>
                        </div>
                        <div class="info-section">
                          <span class="course-info">{{ alumni.program }}</span>
                          <span class="id-info">ID: {{ alumni.id }}</span>
                        </div>
                        <div class="email-section">
                          <span class="user-email">{{ alumni.email }}</span>
                        </div>
                      </div>
                    </div>
                  </td>

                  <!-- Year -->
                  <td class="year-cell">
                    <span class="year-text">{{ alumni.year }}</span>
                  </td>

                  <!-- Contact -->
                  <td class="contact-cell">
                    <div class="contact-info">
                      <span class="contact-number">{{ alumni.contact }}</span>
                      <span class="contact-address" *ngIf="alumni.address">{{ alumni.address }}</span>
                    </div>
                  </td>

                  <!-- Status -->
                  <td class="status-cell">
                    <div class="status-badge" [class.verified]="alumni.verified" [class.pending]="!alumni.verified">
                      <ion-icon name="checkmark-circle" *ngIf="alumni.verified"></ion-icon>
                      <ion-icon name="time-outline" *ngIf="!alumni.verified"></ion-icon>
                      <span>{{ alumni.verified ? 'Verified' : 'Pending' }}</span>
                    </div>
                  </td>

                  <!-- Role -->
                  <td class="role-cell">
                    <ion-select
                      [(ngModel)]="alumni.role"
                      placeholder="Set Role"
                      (ionChange)="updateUserRole(alumni, $event)"
                      class="role-select"
                      interface="popover">
                      <ion-select-option value="user">User</ion-select-option>
                      <ion-select-option value="admin">Admin</ion-select-option>
                      <ion-select-option value="moderator">Moderator</ion-select-option>
                    </ion-select>
                  </td>

                  <!-- Actions -->
                  <td class="actions-cell">
                    <div class="action-buttons">
                      <ion-button fill="clear" size="small" color="primary" (click)="viewUserDetails(alumni)" class="action-btn">
                        <ion-icon name="eye-outline" slot="icon-only"></ion-icon>
                      </ion-button>
                      <ion-button fill="clear" size="small" color="warning" (click)="editUser(alumni)" class="action-btn">
                        <ion-icon name="create-outline" slot="icon-only"></ion-icon>
                      </ion-button>
                      <ion-button fill="clear" size="small" color="danger" (click)="deleteUser(alumni.uid)" class="action-btn">
                        <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
                      </ion-button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>

            <!-- Empty State -->
            <div class="empty-alumni" *ngIf="filteredAlumniList.length === 0">
              <ion-icon name="people-outline"></ion-icon>
              <h3>No Alumni Found</h3>
              <p>No alumni match your current search criteria.</p>
            </div>
          </div>
        </div>

        <div class="table-footer">
          <div class="showing-entries">
            Showing {{ filteredAlumniList.length }} of {{ alumniList.length }} users
          </div>
          <ion-buttons class="pagination">
            <ion-button fill="clear" disabled>
              <ion-icon name="chevron-back-outline"></ion-icon>
            </ion-button>
            <ion-button fill="clear" class="active">1</ion-button>
            <ion-button fill="clear">2</ion-button>
            <ion-button fill="clear">3</ion-button>
            <ion-button fill="clear">
              <ion-icon name="chevron-forward-outline"></ion-icon>
            </ion-button>
          </ion-buttons>
        </div>
        </div> <!-- End Alumni Tab -->

        <!-- Registry Approval Tab -->
        <div *ngIf="activeTab === 'registry-approval'">
          <div class="panel-header">
            <div>
              <h2>Registry Approval</h2>
              <p class="breadcrumb">Dashboard / Registry Approval</p>
            </div>
            <div class="header-actions">
              <ion-button fill="outline" size="small" color="primary" (click)="refreshRegistryRequests()">
                <ion-icon name="refresh" slot="start"></ion-icon>
                Refresh
              </ion-button>
              <ion-button fill="clear" class="notification-btn">
                <ion-icon name="notifications-outline"></ion-icon>
                <ion-badge color="danger" *ngIf="pendingRegistrations.length > 0">{{ pendingRegistrations.length }}</ion-badge>
              </ion-button>
            </div>
          </div>

          <!-- Stats Row -->
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon"><ion-icon name="hourglass-outline"></ion-icon></div>
              <div class="stat-meta">
                <div class="stat-label">Pending Registrations</div>
                <div class="stat-value">{{ pendingRegistrations.length || 0 }}</div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon"><ion-icon name="checkmark-circle"></ion-icon></div>
              <div class="stat-meta">
                <div class="stat-label">Approved Today</div>
                <div class="stat-value">{{ approvedToday || 0 }}</div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon"><ion-icon name="close-circle"></ion-icon></div>
              <div class="stat-meta">
                <div class="stat-label">Declined Today</div>
                <div class="stat-value">{{ declinedToday || 0 }}</div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon"><ion-icon name="people"></ion-icon></div>
              <div class="stat-meta">
                <div class="stat-label">Total Requests</div>
                <div class="stat-value">{{ totalRegistryRequests || 0 }}</div>
              </div>
            </div>
          </div>

          <!-- Pending Registrations -->
          <div class="panel-subheader">
            <h3>
              <ion-icon name="hourglass-outline"></ion-icon>
              Pending Alumni Registrations
            </h3>
            <p class="muted">Review and approve or decline registration requests below.</p>
          </div>

          <div class="table-container">
            <div *ngIf="loadingRegistryRequests" class="loading-state">
              <ion-spinner name="crescent"></ion-spinner>
              <p>Loading registration requests...</p>
            </div>

            <div class="requests-grid" *ngIf="!loadingRegistryRequests">
              <div class="request-card" *ngFor="let request of pendingRegistrations">
                <div class="request-header">
                  <div class="user-info">
                    <div class="user-avatar">
                      <ion-icon name="person-circle" *ngIf="!request.photoURL"></ion-icon>
                      <img [src]="request.photoURL" *ngIf="request.photoURL" alt="User Photo">
                    </div>
                    <div class="user-details">
                      <h4 class="user-name">{{ request.fullName || request.name }}</h4>
                      <p class="user-email">{{ request.email }}</p>
                      <span class="status-badge pending">Pending Approval</span>
                    </div>
                  </div>
                  <div class="request-date">
                    <span class="date-label">Requested</span>
                    <span class="date-value">{{ request.createdAt?.toDate?.() ? (request.createdAt.toDate() | date:'MMM d, y') : (request.createdAt | date:'MMM d, y') }}</span>
                  </div>
                </div>

                <div class="request-body">
                  <div class="info-grid">
                    <div class="info-item">
                      <ion-icon name="school-outline"></ion-icon>
                      <div>
                        <span class="info-label">Program</span>
                        <span class="info-value">{{ request.program || 'Not specified' }}</span>
                      </div>
                    </div>
                    <div class="info-item">
                      <ion-icon name="calendar-outline"></ion-icon>
                      <div>
                        <span class="info-label">Year Graduated</span>
                        <span class="info-value">{{ request.yearGraduated || 'Not specified' }}</span>
                      </div>
                    </div>
                    <div class="info-item" *ngIf="request.idNumber">
                      <ion-icon name="id-card-outline"></ion-icon>
                      <div>
                        <span class="info-label">Student ID</span>
                        <span class="info-value">{{ request.idNumber }}</span>
                      </div>
                    </div>
                    <div class="info-item" *ngIf="request.contactNumber">
                      <ion-icon name="call-outline"></ion-icon>
                      <div>
                        <span class="info-label">Contact Number</span>
                        <span class="info-value">{{ request.contactNumber }}</span>
                      </div>
                    </div>
                    <div class="info-item" *ngIf="request.address">
                      <ion-icon name="location-outline"></ion-icon>
                      <div>
                        <span class="info-label">Address</span>
                        <span class="info-value">{{ request.address }}</span>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="request-actions">
                  <ion-button
                    color="danger"
                    fill="outline"
                    size="small"
                    (click)="declineRegistration(request)"
                    [disabled]="request.__busy">
                    <ion-icon name="close" slot="start"></ion-icon>
                    Decline
                  </ion-button>
                  <ion-button
                    color="success"
                    fill="solid"
                    size="small"
                    (click)="approveRegistration(request)"
                    [disabled]="request.__busy">
                    <ion-icon name="checkmark" slot="start"></ion-icon>
                    Approve
                  </ion-button>
                </div>
              </div>

              <div class="empty-requests" *ngIf="pendingRegistrations.length === 0">
                <ion-icon name="checkmark-circle-outline"></ion-icon>
                <h3>No Pending Registrations</h3>
                <p>All registration requests have been processed or no new requests have been submitted.</p>
              </div>
            </div>
          </div>
        </div> <!-- End Registry Approval Tab -->

        <!-- Edit Role Modal -->
        <ion-modal [isOpen]="isEditRoleModalOpen" (didDismiss)="closeEditRoleModal()">
          <ng-template>
            <ion-header>
              <ion-toolbar>
                <ion-title>Edit User Role</ion-title>
                <ion-buttons slot="end">
                  <ion-button (click)="closeEditRoleModal()">
                    <ion-icon name="close"></ion-icon>
                  </ion-button>
                </ion-buttons>
              </ion-toolbar>
            </ion-header>
            <ion-content class="user-detail-content">
              <div class="user-detail-container">
                <h2>Edit Role for {{ editingUser?.name }}</h2>
                <ion-item>
                  <ion-label>Role</ion-label>
                  <ion-select [(ngModel)]="editingUserRole">
                    <ion-select-option value="user">User</ion-select-option>
                    <ion-select-option value="alumni-officer">Alumni Officer</ion-select-option>
                    <ion-select-option value="admin">Admin</ion-select-option>
                  </ion-select>
                </ion-item>
                <ion-button expand="block" color="primary" (click)="saveUserRole()" [disabled]="roleSaving">
                  {{ roleSaving ? 'Saving...' : 'Save' }}
                </ion-button>
              </div>
            </ion-content>
          </ng-template>
        </ion-modal>

        <!-- Freedom Wall Tab -->
        <div *ngIf="activeTab === 'freedom-wall'" class="freedom-wall-content">
          <div class="panel-header">
            <div>
              <h2>Freedom Wall</h2>
              <p class="breadcrumb">Dashboard / Freedom Wall</p>
            </div>
            <div class="header-actions">
              <p class="role-label">Alumni Officer</p>
              <ion-button fill="clear" class="notification-btn">
                <ion-icon name="notifications-outline"></ion-icon>
                <ion-badge color="danger">3</ion-badge>
              </ion-button>
            </div>
          </div>

          <!-- Create Post Card -->
          <ion-card class="create-post-card">
            <div class="create-post-header">
              <ion-avatar class="post-avatar">
                <img [src]="adminProfile?.photoURL || 'assets/default-avatar.png'" />
              </ion-avatar>
              <ion-button fill="outline" class="post-prompt" (click)="focusPostInput()">
                Share something with Josenians...
              </ion-button>
            </div>

            <div class="create-post-footer" *ngIf="showPostInput">
              <ion-textarea
                [(ngModel)]="newPost"
                placeholder="What's on your mind?"
                rows="3"
                autoGrow
                maxlength="500"
                class="post-input">
              </ion-textarea>

              <div class="post-actions">
                <div class="action-buttons">
                  <ion-button fill="clear" class="action-button">
                    <ion-icon name="image" color="primary"></ion-icon>
                    Photo
                  </ion-button>
                  <ion-button fill="clear" class="action-button">
                    <ion-icon name="videocam" color="danger"></ion-icon>
                    Video
                  </ion-button>
                </div>
                <ion-button
                  (click)="submitPost()"
                  [disabled]="postLoading || !newPost.trim()"
                  class="post-button"
                  shape="round">
                  {{ postLoading ? 'Posting...' : 'Post' }}
                </ion-button>
              </div>
            </div>
          </ion-card>

          <!-- Posts Feed -->
          <div class="posts-feed">
            <ng-container *ngIf="(posts$ | async) as posts; else loadingPosts">
              <div *ngIf="posts.length === 0" class="empty-feed">
                <div class="empty-content">
                  <ion-icon name="chatbubbles" class="empty-icon"></ion-icon>
                  <h3>Quiet on the Wall</h3>
                  <p>Be the first to share something with your fellow Josenians</p>
                  <ion-button
                    (click)="showPostInput = true"
                    class="first-post-button"
                    shape="round">
                    Create First Post
                  </ion-button>
                </div>
              </div>

              <!-- Post Item -->
              <ion-card *ngFor="let post of posts; trackBy: trackById" class="post-card">
                <div class="post-header">
                  <ion-avatar class="post-author-avatar">
                    <img [src]="post.authorAvatar || 'assets/default-avatar.png'" />
                  </ion-avatar>
                  <div class="post-author-info">
                    <h3 class="author-name">{{ post.authorName || 'Josenian Alumni' }}</h3>
                    <p class="post-time">{{ getTimeAgo(post.timestamp) }}</p>
                  </div>
                  <ion-button
                    *ngIf="canDeletePostSync(post)"
                    fill="clear"
                    class="post-menu"
                    (click)="deletePost(post.id)">
                    <ion-icon name="ellipsis-horizontal"></ion-icon>
                  </ion-button>
                </div>

                <div class="post-content">
                  <p>{{ post.content }}</p>
                </div>

                <div class="post-stats">
                  <div class="likes-count">
                    <ion-icon name="heart" color="danger"></ion-icon>
                    <span>{{ post.likes || 0 }}</span>
                  </div>
                  <div class="comments-count">
                    <span>{{ post.comments?.length || 0 }} comments</span>
                  </div>
                </div>

                <div class="post-actions">
                  <ion-button fill="clear" class="post-action" (click)="likePost(post)">
                    <ion-icon
                      [name]="isPostLiked(post) ? 'heart' : 'heart-outline'"
                      [color]="isPostLiked(post) ? 'danger' : 'medium'">
                    </ion-icon>
                    <span>Like</span>
                  </ion-button>

                  <ion-button fill="clear" class="post-action">
                    <ion-icon name="chatbubble-ellipses-outline" color="medium"></ion-icon>
                    <span>Comment</span>
                  </ion-button>

                  <ion-button fill="clear" class="post-action">
                    <ion-icon name="arrow-redo-outline" color="medium"></ion-icon>
                    <span>Share</span>
                  </ion-button>
                </div>
              </ion-card>
            </ng-container>

            <ng-template #loadingPosts>
              <div class="loading-posts">
                <ion-spinner name="crescent"></ion-spinner>
                <p>Loading community posts...</p>
              </div>
            </ng-template>
          </div>
        </div> <!-- End Freedom Wall Tab -->

        <!-- Other Tabs (Dashboard, Reports, Events) -->
      

        <div *ngIf="activeTab === 'reports'" class="reports-content">
          <div class="panel-header">
            <div>
              <h2>Reports</h2>
              <p class="breadcrumb">Dashboard / Reports</p>
            </div>
          </div>
          <div class="coming-soon">
            <ion-icon name="document-text-outline"></ion-icon>
            <h3>Reports Coming Soon</h3>
            <p>Reporting features are under development</p>
          </div>
        </div>

        <div *ngIf="activeTab === 'events'" class="events-content">
          <div class="panel-header">
            <div>
              <h2>Events</h2>
              <p class="breadcrumb">Dashboard / Events</p>
            </div>
          </div>
          <div class="events-list-card">
    <div class="list-card-header dark-header">
      <h3>
        <ion-icon name="calendar-outline"></ion-icon>
        Events
      </h3>
      <ion-button size="small" fill="clear">View all</ion-button>
    </div>
    <ion-list lines="none">
      <ion-item *ngFor="let e of eventsList">
        <ion-label>
          <div class="event-row1">
            <span class="event-name">{{ e.title }}</span>
            <ion-badge *ngIf="e.department">{{ e.department }}</ion-badge>
          </div>
          <div class="event-row2">
            {{ e.date }} {{ e.time }}
            â€¢ {{ e.venue || 'TBA' }}
          </div>
          <div class="event-description" *ngIf="e.description">
            {{ e.description }}
          </div>
          <div class="event-points" *ngIf="e.points">
            <strong>Points:</strong> {{ e.points }}
          </div>
        </ion-label>
        <ion-button fill="clear" color="primary" (click)="editEvent(e)">
          <ion-icon name="create-outline"></ion-icon>
        </ion-button>
        <ion-button fill="clear" color="danger" (click)="deleteEvent(e.id)">
          <ion-icon name="trash-outline"></ion-icon>
        </ion-button>
      </ion-item>
      <div *ngIf="(eventsList?.length || 0) === 0" class="empty-state">
        <ion-icon name="calendar-clear-outline"></ion-icon>
        <p>No events posted.</p>
      </div>
    </ion-list>
  </div>

  <!-- QR Code Generator Card -->
  <div class="event-qr-code-container" style="margin-top:24px;">
    <ion-card>
      <ion-card-header>
        <ion-card-title>Create Event QR Code</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-item>
          <ion-label position="floating">Event Name</ion-label>
          <ion-input [(ngModel)]="eventName"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Date</ion-label>
          <ion-input type="date" [(ngModel)]="eventDate"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Time</ion-label>
          <ion-input type="time" [(ngModel)]="eventTime"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Venue</ion-label>
          <ion-input [(ngModel)]="eventVenue"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Points</ion-label>
          <ion-input type="number" [(ngModel)]="eventPoints"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Description</ion-label>
          <ion-textarea [(ngModel)]="eventDescription"></ion-textarea>
        </ion-item>
        <ion-button expand="block" (click)="generateEventQrCode()">Generate QR Code</ion-button>
        <div *ngIf="qrCodeUrl" style="text-align:center; margin-top:16px;">
          <img [src]="qrCodeUrl" alt="Event QR Code" style="max-width:200px;" />
        </div>
        <ion-button expand="block" color="success" (click)="createEvent()">Create Event</ion-button>
      </ion-card-content>
    </ion-card>
  </div>
        </div>
      </div>
    </div>
  </div>

  <!-- User Detail Modal -->
  <ion-modal [isOpen]="isUserDetailModalOpen" (didDismiss)="closeUserDetailModal()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>User Details</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeUserDetailModal()">
              <ion-icon name="close"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="user-detail-content">
        <div *ngIf="selectedUser" class="user-detail-container">
          <!-- User Profile Section -->
          <div class="profile-section">
            <div class="profile-header">
              <img [src]="selectedUser.photo" class="profile-avatar" alt="Profile" />
              <div class="profile-info">
                <h2>{{ selectedUser.name }}</h2>
                <p class="email">{{ selectedUser.email }}</p>
                <div class="profile-badges">
                  <span class="badge verified" *ngIf="selectedUser.verified">Verified</span>
                  <span class="badge pending" *ngIf="!selectedUser.verified">Pending</span>
                </div>
              </div>
            </div>

            <div class="profile-details">
              <div class="detail-row">
                <span class="label">ID Number:</span>
                <span class="value">{{ selectedUser.id }}</span>
              </div>
              <div class="detail-row">
                <span class="label">Program:</span>
                <span class="value">{{ selectedUser.program }}</span>
              </div>
              <div class="detail-row">
                <span class="label">Graduation Year:</span>
                <span class="value">{{ selectedUser.year }}</span>
              </div>
              <div class="detail-row">
                <span class="label">Contact:</span>
                <span class="value">{{ selectedUser.contact }}</span>
              </div>
              <div class="detail-row">
                <span class="label">Address:</span>
                <span class="value">{{ selectedUser.address }}</span>
              </div>
            </div>
          </div>

          <!-- Employment History Section -->
          <div class="employment-section">
            <h3>Employment History</h3>

            <div *ngIf="loadingUserJobs" class="loading-jobs">
              <ion-spinner name="crescent"></ion-spinner>
              <p>Loading employment history...</p>
            </div>

            <div *ngIf="!loadingUserJobs">
              <!-- Current Jobs -->
              <div class="job-category" *ngIf="getCurrentJobs().length > 0">
                <h4>Current Employment</h4>
                <div class="job-cards">
                  <div *ngFor="let job of getCurrentJobs()" class="job-card current">
                    <div class="job-header">
                      <h5>{{ job.position }}</h5>
                      <span class="job-type current">Current</span>
                    </div>
                    <p class="company">{{ job.companyName }}</p>
                    <div class="job-details">
                      <div class="detail-item">
                        <ion-icon name="calendar-outline"></ion-icon>
                        <span>Started: {{ job.startDate }}</span>
                      </div>
                      <div class="detail-item" *ngIf="job.address">
                        <ion-icon name="location-outline"></ion-icon>
                        <span>{{ job.address }}</span>
                      </div>
                      <div class="detail-item" *ngIf="job.contactNumber">
                        <ion-icon name="call-outline"></ion-icon>
                        <span>{{ job.contactNumber }}</span>
                      </div>
                      <div class="detail-item" *ngIf="job.email">
                        <ion-icon name="mail-outline"></ion-icon>
                        <span>{{ job.email }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Past Jobs -->
              <div class="job-category" *ngIf="getPastJobs().length > 0">
                <h4>Past Employment</h4>
                <div class="job-cards">
                  <div *ngFor="let job of getPastJobs()" class="job-card past">
                    <div class="job-header">
                      <h5>{{ job.position }}</h5>
                      <span class="job-type past">Past</span>
                    </div>
                    <p class="company">{{ job.companyName }}</p>
                    <div class="job-details">
                      <div class="detail-item">
                        <ion-icon name="calendar-outline"></ion-icon>
                        <span>{{ job.startDate }} - {{ job.endDate || 'Present' }}</span>
                      </div>
                      <div class="detail-item" *ngIf="job.address">
                        <ion-icon name="location-outline"></ion-icon>
                        <span>{{ job.address }}</span>
                      </div>
                      <div class="detail-item" *ngIf="job.contactNumber">
                        <ion-icon name="call-outline"></ion-icon>
                        <span>{{ job.contactNumber }}</span>
                      </div>
                      <div class="detail-item" *ngIf="job.email">
                        <ion-icon name="mail-outline"></ion-icon>
                        <span>{{ job.email }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- No Employment History -->
              <div *ngIf="selectedUserJobs.length === 0" class="no-jobs">
                <ion-icon name="briefcase-outline"></ion-icon>
                <p>No employment history available</p>
              </div>
            </div>
          </div>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>

  <!-- Event QR Code Generator Modal -->
  <ion-modal [isOpen]="isEventQrCodeModalOpen" (didDismiss)="closeEventQrCodeModal()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Create Event QR Code</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeEventQrCodeModal()">
              <ion-icon name="close"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="event-qr-code-content">
        <div class="qr-code-container">
          <ion-card>
            <ion-card-header>
              <ion-card-title>Create Event QR Code</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-item>
                <ion-label position="floating">Event Name</ion-label>
                <ion-input [(ngModel)]="eventName"></ion-input>
              </ion-item>
              <ion-item>
                <ion-label position="floating">Date</ion-label>
                <ion-input type="date" [(ngModel)]="eventDate"></ion-input>
              </ion-item>
              <ion-item>
                <ion-label position="floating">Time</ion-label>
                <ion-input type="time" [(ngModel)]="eventTime"></ion-input>
              </ion-item>
              <ion-item>
                <ion-label position="floating">Venue</ion-label>
                <ion-input [(ngModel)]="eventVenue"></ion-input>
              </ion-item>
              <ion-item>
                <ion-label position="floating">Points</ion-label>
                <ion-input type="number" [(ngModel)]="eventPoints"></ion-input>
              </ion-item>
              <ion-item>
    <ion-label position="floating">Description</ion-label>
  <ion-textarea [(ngModel)]="eventDescription"></ion-textarea>
</ion-item>
              <ion-button expand="block" (click)="generateEventQrCode()">Generate QR Code</ion-button>
              <div *ngIf="qrCodeUrl" style="text-align:center; margin-top:16px;">
                <img [src]="qrCodeUrl" alt="Event QR Code" style="max-width:200px;" />
              </div>

              <ion-button expand="block" color="success" (click)="createEvent()">Create Event</ion-button>
            </ion-card-content>
          </ion-card>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>