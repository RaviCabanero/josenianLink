<ion-header class="modern-header">
  <div class="header-container">
    <div class="header-content">
      <!-- Logo Section -->
      <div class="logo-section">
        <div class="logo-wrapper">
          <div class="university-seal">
            <img src="assets/alumnilogo.webp" alt="USJR Seal" class="header-logo">
            <div class="logo-glow"></div>
          </div>
          <div class="brand-text">
            <h1 class="app-title">
              <span class="josenian-text">JOSENIAN</span>
              <span class="link-text">LINK</span>
            </h1>
            <p class="tagline">Events Calendar</p>
          </div>
        </div>
      </div>

      <!-- Actions Section -->
      <div class="actions-section">
        <div class="header-actions">
          <ion-button fill="clear" class="action-btn" (click)="navigateToSettings()">
            <ion-icon name="settings-outline"></ion-icon>
          </ion-button>
          <ion-button fill="clear" class="action-btn logout-btn" (click)="logout()">
            <ion-icon name="log-out-outline"></ion-icon>
          </ion-button>
        </div>
      </div>
    </div>
  </div>
</ion-header>

<ion-content class="calendar-events-content">
  <div class="events-container">
    <!-- Header Section -->
    <div class="events-header">
      <h1>Upcoming Events</h1>
      <p class="subtitle">Stay updated with USJR alumni activities</p>
    </div>

    <!-- Events Cards -->
    <div class="events-grid" *ngIf="(events$ | async) && (events$ | async)!.length > 0">
      <ion-card class="event-card"
                [class.homecoming-card]="event.title.toLowerCase().includes('homecoming')"
                *ngFor="let event of events$ | async">
        <div class="event-image">
          <img [src]="event.image || 'assets/default-event.jpg'" alt="Event Image">
          <div class="event-date-badge"
               [class.homecoming-badge]="event.title.toLowerCase().includes('homecoming')">
            <span class="day">{{ event.date | date:'dd' }}</span>
            <span class="month">{{ event.date | date:'MMM' }}</span>
          </div>
          <div class="event-type-badge" *ngIf="event.title.toLowerCase().includes('homecoming')">
            <ion-icon name="home"></ion-icon>
            <span>Homecoming</span>
          </div>
        </div>

        <ion-card-content>
          <h2 class="event-title" [class.homecoming-title]="event.title.toLowerCase().includes('homecoming')">
            {{ event.title }}
          </h2>
          <div class="event-details">
            <div class="detail-item">
              <ion-icon name="calendar-outline"></ion-icon>
              <span>{{ event.date | date:'EEEE, MMMM d, y' }}</span>
            </div>
            <div class="detail-item">
              <ion-icon name="time-outline"></ion-icon>
              <span>{{ event.time || '9:00 AM' }}</span>
            </div>
            <div class="detail-item">
              <ion-icon name="location-outline"></ion-icon>
              <span>{{ event.location }}</span>
            </div>
          </div>
          <p class="event-description">{{ event.description || 'Join us for this exciting event!' }}</p>

          <div class="event-actions">
            <ion-button fill="outline" size="small" (click)="viewEvent(event)"
                        [class.homecoming-btn-outline]="event.title.toLowerCase().includes('homecoming')">
              <ion-icon name="eye-outline" slot="start"></ion-icon>
              View Details
            </ion-button>
            <ion-button fill="solid" size="small"
                        [color]="event.title.toLowerCase().includes('homecoming') ? 'warning' : 'primary'"
                        [class.homecoming-btn]="event.title.toLowerCase().includes('homecoming')">
              <ion-icon name="calendar-outline" slot="start"></ion-icon>
              RSVP
            </ion-button>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Empty State -->
    <div *ngIf="(events$ | async) && (events$ | async)!.length === 0" class="empty-state">
      <ion-icon name="calendar-outline" size="large"></ion-icon>
      <h3>No Events Yet</h3>
      <p>Stay tuned for upcoming USJR alumni events!</p>
    </div>

    <!-- Alumni ID Section -->
    <div class="alumni-id-section">
      <!-- View Alumni ID Card (for verified users) -->
      <ion-card class="alumni-id-card view-id-card" *ngIf="userProfile?.verified && userProfile?.alumniId">
        <ion-card-header>
          <div class="card-header-content">
            <ion-icon name="card" class="header-icon verified"></ion-icon>
            <div>
              <ion-card-title>Your Alumni ID</ion-card-title>
              <ion-card-subtitle>{{ userProfile.alumniId }}</ion-card-subtitle>
            </div>
          </div>
        </ion-card-header>
        <ion-card-content>
          <ion-button
            expand="block"
            color="success"
            class="view-id-button"
            (click)="viewDigitalAlumniId()">
            <ion-icon name="eye" slot="start"></ion-icon>
            View Digital Alumni ID
          </ion-button>
        </ion-card-content>
      </ion-card>

      <!-- Request Alumni ID Card (for non-verified users) -->
      <ion-card class="alumni-id-card request-id-card" *ngIf="!userProfile?.verified || !userProfile?.alumniId">
        <ion-card-header>
          <div class="card-header-content">
            <ion-icon name="card-outline" class="header-icon"></ion-icon>
            <div>
              <ion-card-title>{{ hasExistingRequest ? 'Alumni ID Request Status' : 'Request Alumni ID' }}</ion-card-title>
              <ion-card-subtitle>{{ hasExistingRequest ? 'Track your request progress' : 'Get your official USJR Alumni identification' }}</ion-card-subtitle>
            </div>
          </div>
        </ion-card-header>

        <ion-card-content>
          <!-- Request Status Display (when user has existing request) -->
          <div *ngIf="hasExistingRequest" class="request-status-section">
            <div class="status-header">
              <div class="status-badge" [ngClass]="'status-' + existingRequest.status">
                <ion-icon 
                  [name]="existingRequest.status === 'pending' ? 'time-outline' : 
                          existingRequest.status === 'approved' ? 'checkmark-circle' : 'close-circle'">
                </ion-icon>
                <span>{{ getRequestStatusText() }}</span>
              </div>
            </div>
            
            <div class="status-details">
              <h3>{{ existingRequest.status === 'pending' ? 'Your request is being processed' : getProcessingMessage() }}</h3>
              <p class="processing-message">{{ getProcessingMessage() }}</p>
              
              <div class="request-info">
                <div class="info-item">
                  <ion-icon name="calendar-outline"></ion-icon>
                  <span>Submitted: {{ getRequestDate() }}</span>
                </div>
                <div class="info-item">
                  <ion-icon name="person-outline"></ion-icon>
                  <span>Name: {{ existingRequest.userName || existingRequest.name }}</span>
                </div>
                <div class="info-item">
                  <ion-icon name="school-outline"></ion-icon>
                  <span>Course: {{ existingRequest.course }}</span>
                </div>
                <div class="info-item">
                  <ion-icon name="calendar-number-outline"></ion-icon>
                  <span>Year: {{ existingRequest.yearGraduated }}</span>
                </div>
              </div>

              <div *ngIf="existingRequest.status === 'approved' && existingRequest.alumniId" class="approved-section">
                <div class="alumni-id-display">
                  <h4>Your Alumni ID:</h4>
                  <div class="id-number">{{ existingRequest.alumniId }}</div>
                  <ion-button fill="outline" (click)="viewAlumniId()">
                    <ion-icon name="card" slot="start"></ion-icon>
                    View Alumni ID Card
                  </ion-button>
                </div>
              </div>

              <div *ngIf="existingRequest.status === 'pending'" class="pending-note">
                <ion-icon name="information-circle-outline"></ion-icon>
                <span>We'll notify you once your request is reviewed. This typically takes 3-5 business days.</span>
              </div>
            </div>
          </div>

          <!-- Request Form (when no existing request) -->
          <form class="alumni-form" *ngIf="!hasExistingRequest">
            <div class="form-row">
              <ion-item class="form-item">
                <ion-label position="floating">First Name</ion-label>
                <ion-input [(ngModel)]="alumniIdRequest.firstName" name="firstName" required></ion-input>
              </ion-item>
              <ion-item class="form-item">
                <ion-label position="floating">Last Name</ion-label>
                <ion-input [(ngModel)]="alumniIdRequest.lastName" name="lastName" required></ion-input>
              </ion-item>
            </div>

            <div class="form-row">
              <ion-item class="form-item">
                <ion-label position="floating">Email Address</ion-label>
                <ion-input [(ngModel)]="alumniIdRequest.email" name="email" type="email" required></ion-input>
              </ion-item>
              <ion-item class="form-item">
                <ion-label position="floating">Contact Number</ion-label>
                <ion-input [(ngModel)]="alumniIdRequest.contactNumber" name="contact" type="tel" required></ion-input>
              </ion-item>
            </div>

            <div class="form-row">
              <ion-item class="form-item">
                <ion-label position="floating">Year Graduated</ion-label>
                <ion-datetime 
                  [(ngModel)]="alumniIdRequest.yearGraduated" 
                  name="yearGraduated" 
                  presentation="year"
                  interface="popover"
                  prefer-wheel="false"
                  [max]="currentYear"
                  [min]="1950"
                  required>
                </ion-datetime>
              </ion-item>
              <ion-item class="form-item">
                <ion-label position="stacked">Course/Program</ion-label>
                <ion-select 
                  [(ngModel)]="alumniIdRequest.course" 
                  name="course" 
                  required 
                  placeholder="Select Program"
                  interface="popover"
                  okText="Okay"
                  cancelText="Cancel">
                  <ion-select-option value="BSIT">BSIT - Bachelor of Science in Information Technology</ion-select-option>
                  <ion-select-option value="BSBA">BSBA - Bachelor of Science in Business Administration</ion-select-option>
                  <ion-select-option value="BSN">BSN - Bachelor of Science in Nursing</ion-select-option>
                </ion-select>
              </ion-item>
            </div>

            <div class="form-row">
              <ion-item class="form-item">
                <ion-label position="floating">Student ID Number</ion-label>
                <ion-input [(ngModel)]="alumniIdRequest.studentId" name="studentId" required></ion-input>
              </ion-item>
            </div>

            <ion-button
              expand="block"
              color="primary"
              class="submit-button"
              (click)="submitAlumniIdRequest()"
              [disabled]="loading || !isFormValid()">
              <ion-icon name="send" slot="start"></ion-icon>
              {{ loading ? 'Submitting...' : 'Submit Request' }}
            </ion-button>

            <div *ngIf="requestSuccess" class="success-message">
              <ion-icon name="checkmark-circle" color="success"></ion-icon>
              <span>Your Alumni ID request has been submitted successfully!</span>
            </div>
          </form>
        </ion-card-content>
      </ion-card>
    </div> <!-- Close alumni-id-section -->
  </div>
</ion-content>

<ion-footer class="modern-footer">
  <ion-toolbar>
    <div class="footer-buttons">
      <ion-button fill="clear" routerLink="/home" class="footer-nav-btn">
        <ion-icon name="home" slot="icon-only"></ion-icon>
        <span class="nav-label"></span>
      </ion-button>
      <ion-button fill="clear" routerLink="/events" class="footer-nav-btn active">
        <ion-icon name="calendar" slot="icon-only"></ion-icon>
        <span class="nav-label"></span>
      </ion-button>
      <ion-button fill="clear" routerLink="/notifications" class="footer-nav-btn">
        <ion-icon name="notifications" slot="icon-only"></ion-icon>
        <span class="nav-label"></span>
      </ion-button>
      <ion-button fill="clear" routerLink="/profile" class="footer-nav-btn">
        <ion-icon name="person" slot="icon-only"></ion-icon>
        <span class="nav-label"></span>
      </ion-button>
      <ion-button fill="clear" routerLink="/messages" class="footer-nav-btn">
        <ion-icon name="chatbox-ellipses" slot="icon-only"></ion-icon>
        <span class="nav-label"></span>
      </ion-button>
    </div>
  </ion-toolbar>
</ion-footer>
