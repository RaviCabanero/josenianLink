
<ion-header class="custom-header">
  <div class="header-bar">
    <div class="logo-title">
      <strong class="logo-green">JOSENIAN</strong><span class="logo-yellow">LINK</span> ðŸ”—
    </div>
    <div class="header-actions">
      <ion-button fill="clear" class="header-button notification-btn" (click)="navigateToNotifications()">
        <ion-icon name="notifications" slot="icon-only"></ion-icon>
        <ion-badge *ngIf="unreadNotifications > 0" color="danger">{{ unreadNotifications }}</ion-badge>
      </ion-button>
      <ion-button fill="clear" class="header-button" (click)="createTestNotification()">
        <ion-icon name="add" slot="icon-only"></ion-icon>
      </ion-button>
      <ion-button fill="clear" class="header-button" (click)="navigateToSettings()">
        <ion-icon name="settings" slot="icon-only"></ion-icon>
      </ion-button>
      <ion-button fill="clear" class="logout-button" (click)="logout()">
        Log Out
      </ion-button>
    </div>
  </div>
</ion-header>

<ion-content class="content-wrapper">
  <!-- Create Post Card -->
  <ion-card class="create-post-card">
    <div class="create-post-header">
      <ion-avatar class="post-avatar">
        <img [src]="userProfile?.photoURL || 'assets/default-avatar.png'" />
      </ion-avatar>
      <ion-button fill="outline" class="post-prompt" (click)="focusPostInput()">
        Share something with Josenians...
      </ion-button>
    </div>
    
    <div class="create-post-footer" *ngIf="showPostInput">
      <ion-textarea
        [(ngModel)]="newPost"
        placeholder="What's on your mind?"
        rows="3"
        autoGrow
        maxlength="500"
        class="post-input">
      </ion-textarea>

      <!-- Image Preview Section -->
      <div class="image-preview-section" *ngIf="selectedImage">
        <div class="image-preview-container">
          <img [src]="selectedImage" alt="Selected image" class="preview-image">
          <ion-button fill="clear" class="remove-image-btn" (click)="removeSelectedImage()">
            <ion-icon name="close-circle" color="danger"></ion-icon>
          </ion-button>
        </div>
      </div>

      <div class="post-actions">
        <div class="action-buttons">
          <ion-button fill="clear" class="action-button" (click)="selectImage()">
            <ion-icon name="image" color="primary"></ion-icon>
            Photo
          </ion-button>
          <ion-button fill="clear" class="action-button">
            <ion-icon name="videocam" color="danger"></ion-icon>
            Video
          </ion-button>
          <ion-button fill="clear" class="action-button" (click)="cancelPost()">
            <ion-icon name="close" color="medium"></ion-icon>
            Cancel
          </ion-button>
        </div>
        <ion-button
          (click)="submitPost()"
          [disabled]="loading || (!newPost.trim() && !selectedImage)"
          class="post-button"
          shape="round">
          {{ loading ? 'Posting...' : 'Post' }}
        </ion-button>
      </div>
    </div>

    <!-- Hidden file input -->
    <input type="file" #fileInput accept="image/*" (change)="onImageSelected($event)" style="display: none;">
  </ion-card>

  <!-- Posts Feed -->
  <div class="posts-feed">
    <ng-container *ngIf="(posts$ | async) as posts; else loadingPosts">
      <div *ngIf="posts.length === 0" class="empty-feed">
        <div class="empty-content">
          <ion-icon name="chatbubbles" class="empty-icon"></ion-icon>
          <h3>Quiet on the Wall</h3>
          <p>Be the first to share something with your fellow Josenians</p>
          <ion-button 
            (click)="showPostInput = true" 
            class="first-post-button"
            shape="round">
            Create First Post
          </ion-button>
        </div>
      </div>

      <!-- Post Item -->
      <ion-card *ngFor="let post of posts" class="post-card">
        <div class="post-header">
          <ion-avatar class="post-author-avatar">
            <img [src]="post.authorAvatar || 'assets/default-avatar.png'" />
          </ion-avatar>
          <div class="post-author-info">
            <h3 class="author-name">{{ post.authorName || 'Josenian Alumni' }}</h3>
            <p class="post-time">{{ getTimeAgo(post.timestamp) }}</p>
          </div>
          <ion-button
            *ngIf="canDeletePostSync(post)"
            fill="clear"
            class="post-menu"
            (click)="deletePost(post.id)">
            <ion-icon name="ellipsis-horizontal"></ion-icon>
          </ion-button>
        </div>

        <div class="post-content">
          <p *ngIf="post.content">{{ post.content }}</p>

          <!-- Post Image -->
          <div class="post-image-container" *ngIf="post.imageUrl">
            <img [src]="post.imageUrl" alt="Post image" class="post-image" (click)="viewFullImage(post.imageUrl)">
          </div>
        </div>

        <!-- Removed like, comment, share, and react count -->

        <div class="post-actions" style="justify-content: flex-end;">
          <ion-button fill="clear" class="post-action" style="margin-left: auto;" (click)="clickLink(post)">
            <ion-icon name="link-outline" style="color: #057609;"></ion-icon>
            <span style="margin-left: 6px; color: #057609; font-weight: 600;">{{ post.linkClicks || 0 }}</span>
          </ion-button>
        </div>
      </ion-card>
    </ng-container>

    <ng-template #loadingPosts>
      <div class="loading-posts">
        <ion-spinner name="crescent"></ion-spinner>
        <p>Loading community posts...</p>
      </div>
    </ng-template>
  </div>
</ion-content>

<ion-footer class="modern-footer">
  <ion-toolbar>
    <div class="footer-buttons">
      <ion-button fill="clear" routerLink="/home" class="active">
        <ion-icon name="home" slot="icon-only"></ion-icon>
        <span class="nav-label">Home</span>
      </ion-button>
      <ion-button fill="clear" routerLink="/events">
        <ion-icon name="calendar" slot="icon-only"></ion-icon>
      </ion-button>
      <ion-button fill="clear" routerLink="/notifications">
        <ion-icon name="notifications" slot="icon-only"></ion-icon>
      </ion-button>
      <ion-button fill="clear" routerLink="/profile">
        <ion-icon name="person" slot="icon-only"></ion-icon>
        <span class="nav-label">Profile</span>
      </ion-button>
      <ion-button fill="clear" routerLink="/messages" class="footer-nav-btn">
        <ion-icon name="chatbox-ellipses" slot="icon-only"></ion-icon>
        <span class="nav-label">Messages</span>
        <div class="notification-badge" *ngIf="unreadMessages > 0">{{ unreadMessages }}</div>
      </ion-button>
    </div>
  </ion-toolbar>
</ion-footer>
